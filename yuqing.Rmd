---
output: html_document
---

```{r}
library(tidyverse)
library(jsonlite)
library(httr)
```

```{r}
r <- GET(
  "https://api.yelp.com/v3/businesses/search",
  add_headers(Authorization = paste("Bearer", Sys.getenv("YELP_API_KEY"))),
  query = list(
    location = "Davis",
    limit = 50
  )
)
stop_for_status(r)
json <- content(r, as = "text")

res <- fromJSON(json)

#z <- tempfile()
#download.file(res$businesses$image_url[1], z, mode = 'wb')
#pic <- readJPEG(z)
#file.remove(z)

#write.table(res$businesses[c("name", "rating", "price")], "test_data.txt")
#write_json(res, "test_data.json")


knitr::include_graphics(res$businesses$image_url[1])
```

```{r}
res$businesses$coordinates

res$businesses$coordinates %>% 
plot_geo(locationmode = 'USA-states') %>% 
  add_markers(y = ~latitude, x = ~longitude) %>% 
  add_trace()

county <- map_data("county")
c <- county %>% 
  filter(region == "california" & subregion == 'yolo')


```

